\section{Introduction}
\label{sec:introduction}

Electron energy-loss spectroscopy (EELS) within the transmission electron microscope (TEM) provides
a wide range of
valuable information on the structural, chemical, and electronic properties of nanoscale materials.
%
Thanks to recent instrumentation breakthroughs
such as electron monochromators~\cite{Terauchi:2005, Freitag:2005} and aberration correctors~\cite{Haider:1998},
modern EELS analyses can map these properties with unprecedented spatial and spectral resolution.
%
A particularly important region of the EEL spectra is
the low-loss region, defined by those electrons that have lost
less than a few eV ($\Delta E\lsim 5$ GeV) following their inelastic interactions
with the sample.
%
The analysis of this low-loss region makes possible charting the local
electronic properties of nanomaterials~\cite{Geiger:1967}, from the characterisation of
bulk and surface plasmons~\cite{Schaffer:2008}, excitons~\cite{Erni:2005}, 
inter- and intra-band transitions~\cite{Rafferty:1998},
and phonons to the determination of their bandgap and band structure~\cite{Stoger:2008}.

Provided the sample is electron-transparent, as required for TEM inspection,
in EELS the bulk of the incident electron beam will traverse it
either without interacting or restricted to elastic scatterings with the atoms
of the sample's crystalline lattice.
%
These electrons are recorded as a narrow,
 high intensity peak centered at energy losses
of $\Delta E\simeq 0$ and known as the zero loss peak (ZLP).
%
The energy resolution of EELS analyses is ultimately determined by
the electron beam size of the system, often expressed in terms
of the full width at half maximum (FWHM) of the
ZLP~\cite{Egerton:2009}.
%
In the low-loss region, the contribution from the ZLP
often overwhelms that from  from the inelastic scatterings arising with
the interactions of the beam electrons
with the sample.
%
Therefore, relevant signals of low-loss phenomena such as excitons,
phonons, and intraband transitions risk being drowned
in ZLP tail~\cite{Abajo:2010}.
%
An accurate removal of the ZLP
contribution is thus crucial  in order to efficiently chart and identify the  features
of the low-loss  region in EEL spectra. 

The properties of the ZLP in monochromated EELS depend on the electron energy dispersion,
the monochromator alignment, and the sample thickness~\cite{Park:2008, Stoger:2008}.
%
The first two factors arise already in the absence of a specimen (vacuum operation),
while the third one is associated
to elastic scatterings with the sample such as atomic scatterings,
phonon excitation, and exciton losses.
%
This implies that  measurements of vacuum EEL spectra can be used for calibration purposes
but not to subtract the ZLP from spectra taken on specimens, since their shapes will differ
in general.

Several approaches to ZLP subtraction have been put forward in 
literature~\cite{Rafferty:2000, Stoger:2008, Egerton:1996}.
%
These are often based on specific model assumptions about the ZLP properties, specifically
concerning its parametric functional dependence, from Lorentzian~\cite{Dorneich:1998}
and power laws~\cite{Erni:2005} to more general multiple-parameter functions~\cite{Benthem:2001}.
%
Another approach is based on the mirroring the $\Delta E <0$ region of the spectra, assuming
that the $\Delta E>0$ region is fully symmetric~\cite{Lazar:2003}.
%
More recent studies use integrated software applications for background subtraction 
methods~\cite{Egerton:10.1016/S0304-3991(01)00155-3, Held:2020, Granerod:2018, Fung:2020}.
%
These  subtraction methods are however affected by three main limitations.
%
Firstly, they rely on specific model assumptions {\it e.g.} with
the choice of functional form, introducing a methodological
bias whose size is difficult to quantify.
%
Secondly, they lack an estimate of the associated uncertainties, which in turn affects
the reliability of any physical interpretations of the low loss region such as the band gap extraction.
%
Thirdly, {\it ad hoc} choices of such as those of the fitting ranges introduce a significant degree of
arbitrariness in the procedure.

Here we bypass these limitations by developing a model-independent strategy
for ZLP subtractions in EELS by means of machine learning (ML) techniques.
%
Our strategy is based on the NNPDF approach~\cite{Ball:2008by,Ball:2012cx,Ball:2014uwa,Ball:2017nwa}
developed for studies
of the quark and gluon structure of protons in high-energy particle collisions.
%
The main idea is to combine the  Monte Carlo replica  method to construct a probability
distribution in the space of experimental data with artificial
neural networks as unbiased interpolators to describe the ZLP.
%
This way one achieves
a faithful sampling of the probability distribution in the space of ZLP,
which then can be applied to subtract its contribution to EEL spectra while keeping
full track of all the associated
data, model, and parametrisation uncertainties.
%
This approach is amenable to assembling high-dimensionality parametrisations
of ZLP spectra with multiple inputs, and extrapolate them reliably
to other operation conditions of the microscope beyond those included
in the training dataset.

In recent years
machine learning techniques have been deployed in several studies
related to transmission electron microscopy methods
in the context of material science~\cite{Gordon:2020, Zhang:2019, Jany:2017, Ziatdinov:2017}.
%
Representative examples
include the automated identification
of atomic-level structural information~\cite{10.1145/2834892.2834896},
the extraction of chemical information
and defect classification~\cite{doi:10.1021/acsnano.7b07504},
and spatial resolution enhancement
using  using a generative adversarial network~\cite{cite-key}.
%
Our work represents to the best of our knowledge
the first time that neural networks are used as 
 unbiased
background removal interpolators, and combined with Monte Carlo sampling to construct a faithful estimate
of the ML model uncertainties.

Our work is composed of two main parts.
%
In the first one, we construct a ML model of ZLP spectra taken
in vacuum which accommodates an  arbitrary number of input
variables, corresponding to a range of operation conditions of the TEM.
%
We demonstrate how the model describes successfully all
input spectra and assess its extrapolation for other operation
conditions.
%
In the second part, we construct a one-dimensional model
of the ZLP as a function of the energy loss $\Delta E$ from EEL spectra taken on
tungsten disulfide (WS$_2$) nanoflowers.
%
WS$_2$ is a two-dimensional material member of the transition metal dichalcogenide (TMD) family,
which exhibits many remarkable structural and electric properties.
%
This ML model of the in-sample ZLP is then used to subtract its contribution
from the WS$_2$ EEL spectra, allowing us determine the value of the bandgap $E_{\rm BG}$
and the local character of the band structure for different regions of the nanoflowers.
%
Thanks to this strategy  we demonstrate that bilayer WS$_2$ exhibits a direct bandgap
with value $E_{\rm BG}= 2.05 \pm 0.12$ eV.
%
This results are consistent with other determinations of the bandgap of bilayer WS$_2$.

The paper is organized as follows.
%
First of all in Sect.~\ref{sec:eels}
we describe the main features of EELS, focusing on the low-loss region.
%
In Sect.~\ref{sec:tmd} we summarise relevant properties of TMD materials,
with emphasis on WS$_2$.
%
Then in Sect.~\ref{sec:methodology} we describe our machine learning methodology
and discuss its application to the in-vacuum and in-sample
ZLP parametrisations.
%
In Sects.~\ref{sec:results_vacuum} and~\ref{sec:results_sample}
we present our results for the ZLP parametrisation
in-vacuum and in-sample respectively, which in the latter
case is used to probe the local band structure properties
of WS$_2$ nanostructures.
%
Finally in Sect.~\ref{sec:summary} we summarise
and outline possible future developments.
